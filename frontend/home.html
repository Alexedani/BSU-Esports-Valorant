<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valorant Ranked Tracking Tool</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Background image -->
    <img src="esports-arena.webp" alt="Valorant Background" class="background">


  <!-- Logo -->
  <div class="logo-container">
    <img src="bsu-logo-esports.webp" alt="Boise State Logo" class="logo">
  </div>

  <!-- Card -->
  <div class="card">
    <h1>Valorant Ranked Tracking</h1>

    <div class="form-group">
      <input type="text" id="playerName" placeholder="Player Name">
      <input type="text" id="playerTag" placeholder="Tag">
      <button onclick="addPlayer()">Add Player</button>
    </div>

    <h2>Tracked Players</h2>
    <div class="table-container">
      <table id="playersTable">
        <thead>
          <tr>
            <th>Player Name</th>
            <th>Tag</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <!-- Added players will show here -->
        </tbody>
      </table>
    </div>

<button class="scrape-btn" onclick="runScraper()">Run Scrape Now</button>
  </div>

<script>
  const BASE_URL = "https://your-render-service.onrender.com"; // <-- replace with your Render backend URL

  // --- Add Player ---
  function addPlayer() {
    const name = document.getElementById("playerName").value.trim();
    const tag = document.getElementById("playerTag").value.trim();
    if (!name || !tag) return alert("Enter both name and tag!");

    fetch(`${BASE_URL}/save-player`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, tag })
    })
      .then(res => res.json())
      .then(players => renderPlayers(players))
      .catch(err => console.error("Error saving player:", err));
  }

  // --- Remove Player ---
  function removePlayer(name) {
    fetch(`${BASE_URL}/remove-player`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name })
    })
      .then(res => res.json())
      .then(players => renderPlayers(players))
      .catch(err => console.error("Error removing player:", err));
  }

  // --- Render Players Table ---
  function renderPlayers(players) {
    const tbody = document.querySelector("#playersTable tbody");
    tbody.innerHTML = "";

    const entries = Object.entries(players); // [ [name, tag], [name, tag], ... ]

    if (entries.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3" class="empty-msg">No players being tracked yet</td></tr>`;
      return;
    }

    entries.forEach(([name, tag]) => {
      const row = `
        <tr>
          <td>${name}</td>
          <td>${tag}</td>
          <td class="remove-cell">
            <button class="remove-btn" onclick="removePlayer('${name}')">‚ùå</button>
          </td>
        </tr>`;
      tbody.innerHTML += row;
    });
  }

  // --- Load Players on Page Load ---
  function loadPlayers() {
    fetch(`${BASE_URL}/players`)
      .then(res => res.json())
      .then(players => renderPlayers(players))
      .catch(err => console.error("Error loading players:", err));
  }

  // --- Run Scraper ---
  function runScraper() {
    fetch(`${BASE_URL}/run-scraper`, { method: "POST" })
      .then(res => res.json())
      .then(data => {
        console.log("Scraper results:", data);
        alert("Scraper finished! Check Google Sheets or console for results.");
      })
      .catch(err => console.error("Error running scraper:", err));
  }

  // --- Auth Check ---
  if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "index.html";
  } else {
    loadPlayers();
  }
</script>


</body>
</html>
