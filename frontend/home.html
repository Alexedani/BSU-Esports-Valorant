<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valorant Ranked Tracking Tool</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Background image -->
    <img src="esports-arena.webp" alt="Valorant Background" class="background">


  <!-- Logo -->
  <div class="logo-container">
    <img src="bsu-logo-esports.webp" alt="Boise State Logo" class="logo">
  </div>

  <!-- Card -->
  <div class="card">
    <h1>Valorant Ranked Tracking</h1>

    <div class="form-group">
      <input type="text" id="playerName" placeholder="Player Name">
      <input type="text" id="playerTag" placeholder="Tag">
      <button onclick="addPlayer()">Add Player</button>
    </div>

    <h2>Tracked Players</h2>
    <div class="table-container">
      <table id="playersTable">
        <thead>
          <tr>
            <th>Player Name</th>
            <th>Tag</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <!-- Added players will show here -->
        </tbody>
      </table>
    </div>

<button class="scrape-btn" onclick="runScraper()">Run Scrape Now</button>
  </div>

<script>
  const BASE_URL = "https://bsu-esports-valorant.onrender.com"; // your Render backend

  // Add Player
  async function addPlayer() {
    const name = document.getElementById("playerName").value.trim();
    const tag = document.getElementById("playerTag").value.trim();
    if (!name || !tag) {
      return alert("Enter both name and tag!");
    }

    const res = await fetch(`${BASE_URL}/save-player`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, tag })
    });

    if (res.ok) {
      await renderPlayers();
      document.getElementById("playerName").value = "";
      document.getElementById("playerTag").value = "";
    } else {
      alert("Error adding player");
    }
  }

  // Remove Player
  async function removePlayer(name) {
    const res = await fetch(`${BASE_URL}/remove-player`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name })
    });

    if (res.ok) {
      await renderPlayers();
    } else {
      alert("Error removing player");
    }
  }

  // Render Players Table
  async function renderPlayers() {
    const tbody = document.querySelector("#playersTable tbody");
    tbody.innerHTML = "";

    const res = await fetch(`${BASE_URL}/players`);
    const players = await res.json();

    const names = Object.keys(players);
    if (names.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3" class="empty-msg">No players being tracked yet</td></tr>`;
      return;
    }

    names.forEach((name) => {
      const tag = players[name];
      const row = `
        <tr>
          <td>${name}</td>
          <td>${tag}</td>
          <td class="remove-cell">
            <button class="remove-btn" onclick="removePlayer('${name}')">‚ùå</button>
          </td>
        </tr>`;
      tbody.innerHTML += row;
    });
  }

  // Run Scraper
  async function runScraper() {
    const btn = document.querySelector(".scrape-btn");
    btn.disabled = true;
    btn.innerText = "Running scrape...";

    const res = await fetch(`${BASE_URL}/run-scraper`, { method: "POST" });
    if (res.ok) {
      const data = await res.json();
      console.log("Scraper results:", data);
      alert("Scrape finished! Check console for results.");
    } else {
      alert("Scrape failed.");
    }

    btn.disabled = false;
    btn.innerText = "Run Scrape Now";
  }

  // Redirect if not logged in
  if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "index.html";
  }

  // Initial load
  renderPlayers();
</script>



</body>
</html>
